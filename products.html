<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>All Products - S Shop LK</title>
    <!-- Favicon -->
    <script src="favicon.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="font-loader.js"></script>
    <style>
        
        :root {
            --brand-primary: #3b82f6;
            --brand-dark: #0f172a;
        }

        body {
            background-color: var(--brand-dark);
            color: #f1f5f9;
            -webkit-font-smoothing: antialiased;
        }
        
        .glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Smooth Bottom Sheet Animation */
        #mobileMenuOverlay {
            transition: opacity 0.3s ease;
        }
        #mobileMenuContent {
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            transform: translateY(100%);
        }
        #mobileMenuOverlay.active #mobileMenuContent {
            transform: translateY(0);
        }

        /* Premium Card Design */
        .product-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(59, 130, 246, 0.1);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Force hide description on mobile, show on desktop */
        .product-description {
            display: none !important;
        }
        @media (min-width: 768px) {
            .product-description {
                display: -webkit-box !important;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .reveal { animation: fadeIn 0.4s ease forwards; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header Container -->
    <div id="header-container" class="sticky top-0 z-50"></div>

    <!-- Hero Section -->
    <div class="relative pt-12 pb-6 md:pt-20 md:pb-16 bg-slate-950">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,rgba(59,130,246,0.05),transparent)] pointer-events-none"></div>
        <div class="container mx-auto px-4 relative z-10">
            <h1 class="text-3xl md:text-5xl font-extrabold text-white mb-2 tracking-tight">Explore <span class="text-blue-500">Inventory</span></h1>
            <p class="text-slate-400 text-sm md:text-lg max-w-xl">Premium gaming accounts and digital assets delivered instantly.</p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6">
        
        <!-- Search & Filter Area -->
        <div class="mb-10 space-y-4">
            <div class="flex flex-col md:flex-row gap-3">
                <!-- Search Bar -->
                <div class="relative flex-grow group">
                    <input type="text" id="searchInput" placeholder="Search accounts, licenses..." 
                           class="w-full bg-slate-900/50 border border-slate-800 text-white pl-12 pr-4 py-4 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none transition-all placeholder:text-slate-600" 
                           onkeyup="if(event.key === 'Enter') handleSearch()">
                    <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-blue-500 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                    </div>
                </div>

                <!-- Mobile Category Trigger -->
                <button onclick="toggleMobileMenu(true)" class="md:hidden flex items-center justify-between bg-slate-900 border border-slate-800 px-5 py-4 rounded-2xl text-white font-medium active:scale-95 transition-transform">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/></svg>
                        <span id="currentCategoryLabel">All Categories</span>
                    </div>
                    <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </button>

                <!-- Desktop Category Select -->
                <div class="hidden md:block">
                    <select id="categoryFilter" onchange="filterProducts(this.value)" class="bg-slate-900 border border-slate-800 text-white px-6 py-4 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none cursor-pointer h-full hover:bg-slate-800 transition-colors">
                        <option value="all">All Categories</option>
                        <option value="games">Games</option>
                        <option value="software-apps">Software & Apps</option>
                        <option value="boosting-coaching">Boosting</option>
                        <option value="gift-cards">Gift Cards</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Products Grid -->
        <section class="min-h-[400px]">
            <p id="searchError" class="hidden text-center text-slate-500 py-20 bg-slate-900/20 rounded-3xl border border-dashed border-slate-800">
                <span class="block text-3xl mb-2">üîç</span> No matches found for your search.
            </p>
            <p id="categoryError" class="hidden text-center text-slate-500 py-20 bg-slate-900/20 rounded-3xl border border-dashed border-slate-800">
                <span class="block text-3xl mb-2">üì¶</span> No items in this category yet.
            </p>
            <div id="productContainer" class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-8">
                <!-- Products injected here -->
            </div>
        </section>

        <!-- Pagination -->
        <section id="paginationContainer" class="flex justify-center items-center space-x-2 mt-16 mb-12"></section>

    </main>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- MOBILE CATEGORY MENU (Bottom Sheet) -->
    <div id="mobileMenuOverlay" class="fixed inset-0 z-[100] bg-black/60 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="absolute inset-0" onclick="toggleMobileMenu(false)"></div>
        <div id="mobileMenuContent" class="absolute bottom-0 left-0 right-0 glass rounded-t-[2.5rem] p-6 pb-10">
            <!-- Pull Indicator -->
            <div class="w-12 h-1.5 bg-slate-700 rounded-full mx-auto mb-8"></div>
            
            <h3 class="text-xl font-bold text-white mb-6 px-2">Select Category</h3>
            
            <div class="grid gap-3">
                <button onclick="selectMobileCategory('all', 'Everything')" class="flex items-center gap-4 w-full p-4 rounded-2xl bg-blue-600/10 border border-blue-500/20 text-blue-400 font-bold text-left">
                    <span class="w-2 h-2 rounded-full bg-blue-500"></span> Everything
                </button>
                <button onclick="selectMobileCategory('games', 'Games')" class="flex items-center gap-4 w-full p-4 rounded-2xl bg-slate-800/50 border border-slate-700/50 text-white font-medium text-left">
                    <span class="w-2 h-2 rounded-full bg-slate-600"></span> Games
                </button>
                <button onclick="selectMobileCategory('software-apps', 'Software')" class="flex items-center gap-4 w-full p-4 rounded-2xl bg-slate-800/50 border border-slate-700/50 text-white font-medium text-left">
                    <span class="w-2 h-2 rounded-full bg-slate-600"></span> Software & Apps
                </button>
                <button onclick="selectMobileCategory('boosting-coaching', 'Boosting')" class="flex items-center gap-4 w-full p-4 rounded-2xl bg-slate-800/50 border border-slate-700/50 text-white font-medium text-left">
                    <span class="w-2 h-2 rounded-full bg-slate-600"></span> Boosting
                </button>
                <button onclick="selectMobileCategory('gift-cards', 'Gift Cards')" class="flex items-center gap-4 w-full p-4 rounded-2xl bg-slate-800/50 border border-slate-700/50 text-white font-medium text-left">
                    <span class="w-2 h-2 rounded-full bg-slate-600"></span> Gift Cards
                </button>
            </div>
            
            <button onclick="toggleMobileMenu(false)" class="w-full mt-6 py-4 text-slate-500 font-medium text-center">Cancel</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="header-component.js"></script>
    <script src="footer-component.js"></script>

    <script>
        let products = [];
        let currentCategory = 'all';
        const productsPerPage = 8;
        let currentPage = 1;

        // UI Helpers
        function toggleMobileMenu(show) {
            const overlay = document.getElementById('mobileMenuOverlay');
            if (show) {
                overlay.classList.add('active');
                overlay.style.opacity = '1';
                overlay.style.pointerEvents = 'auto';
                document.body.style.overflow = 'hidden';
            } else {
                overlay.classList.remove('active');
                overlay.style.opacity = '0';
                overlay.style.pointerEvents = 'none';
                document.body.style.overflow = '';
            }
        }

        function selectMobileCategory(val, label) {
            document.getElementById('currentCategoryLabel').textContent = label;
            filterProducts(val);
            toggleMobileMenu(false);
        }

        // Core Logic (Preserved)
        window.addEventListener('load', loadProducts);

        function loadProducts() {
            if (window.FirebaseService) {
                FirebaseService.getProducts().then(p => {
                    products = p.length > 0 ? p : (JSON.parse(localStorage.getItem('sShopProducts')) || []);
                    displayProducts();
                }).catch(() => {
                    products = JSON.parse(localStorage.getItem('sShopProducts')) || [];
                    displayProducts();
                });
            }
        }

        function filterProducts(category) {
            currentCategory = category;
            currentPage = 1;
            displayProducts();
            
            // Sync desktop select if visible
            const desktopSelect = document.getElementById('categoryFilter');
            if(desktopSelect) desktopSelect.value = category;
        }

        function displayProducts() {
            const container = document.getElementById('productContainer');
            const searchError = document.getElementById('searchError');
            const categoryError = document.getElementById('categoryError');
            
            container.innerHTML = '';
            searchError.classList.add('hidden');
            categoryError.classList.add('hidden');

            let filtered = products;
            if (currentCategory !== 'all') {
                filtered = products.filter(p => {
                    const cat = p.category?.toLowerCase() || '';
                    if (currentCategory === 'games') return cat.includes('game');
                    if (currentCategory === 'software-apps') return cat.includes('soft') || cat.includes('app');
                    if (currentCategory === 'boosting-coaching') return cat.includes('boost');
                    if (currentCategory === 'gift-cards') return cat.includes('gift');
                    return true;
                });
            }

            if (currentCategory !== 'all' && filtered.length === 0) {
                categoryError.classList.remove('hidden');
                return;
            }

            const start = (currentPage - 1) * productsPerPage;
            const paginated = filtered.slice(start, start + productsPerPage);

            paginated.forEach((p, idx) => {
                const card = document.createElement('div');
                card.className = "reveal product-card group bg-slate-900 rounded-[2rem] border border-slate-800 overflow-hidden flex flex-col";
                card.style.animationDelay = `${idx * 0.05}s`;
                
                const isSoldOut = !p.availability || p.availability <= 0;
                const detailPage = `dynamic-product-detail.html?id=${p.id}`;

                card.innerHTML = `
                    <div class="relative aspect-[4/3] overflow-hidden bg-slate-800">
                        <a href="${detailPage}">
                            <img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 ${isSoldOut ? 'grayscale opacity-40' : ''}">
                        </a>
                        ${isSoldOut ? `<div class="absolute inset-0 flex items-center justify-center"><span class="bg-black/80 backdrop-blur-md text-white text-[10px] font-black uppercase tracking-widest px-4 py-2 rounded-full border border-white/20">Sold Out</span></div>` : ''}
                        <div class="absolute top-4 left-4 bg-blue-600 text-white text-[9px] font-black uppercase tracking-widest px-3 py-1.5 rounded-full shadow-lg shadow-blue-500/20 z-10">
                            ${p.category || 'Digital'}
                        </div>
                    </div>
                    <div class="p-5 md:p-6 flex flex-col flex-grow">
                        <h3 class="text-sm md:text-lg font-bold text-white mb-2 leading-tight group-hover:text-blue-400 transition-colors line-clamp-2">${p.name}</h3>
                        <p class="product-description text-slate-500 text-xs md:text-sm line-clamp-2 mb-4 leading-relaxed">${p.description}</p>
                        
                        <div class="mt-auto pt-4 border-t border-slate-800/40 flex items-center justify-between">
                            <div>
                                <p class="text-[9px] uppercase font-bold text-slate-500 tracking-widest mb-0.5">Price</p>
                                <span class="text-base md:text-xl font-black text-white">Rs. ${p.price.toLocaleString()}</span>
                            </div>
                            <a href="${detailPage}" class="w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-2xl bg-slate-800 text-white group-hover:bg-blue-600 transition-all duration-300">
                                <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                            </a>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });

            renderPagination(filtered.length);
        }

        function renderPagination(total) {
            const container = document.getElementById('paginationContainer');
            container.innerHTML = '';
            const pages = Math.ceil(total / productsPerPage);
            if (pages <= 1) return;

            const createBtn = (content, isActive, isDisabled, onClick) => {
                const btn = document.createElement('button');
                btn.innerHTML = content;
                btn.disabled = isDisabled;
                btn.className = `w-10 h-10 md:w-12 md:h-12 rounded-xl font-bold transition-all text-xs flex items-center justify-center ${
                    isActive ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 
                    isDisabled ? 'bg-slate-900 text-slate-700 opacity-50 cursor-not-allowed' : 
                    'bg-slate-900 text-slate-400 border border-slate-800 hover:border-slate-600'
                }`;
                btn.onclick = onClick;
                return btn;
            };

            container.appendChild(createBtn('‚Üê', false, currentPage === 1, () => { currentPage--; displayProducts(); window.scrollTo({top:0, behavior:'smooth'}); }));
            
            for (let i = 1; i <= pages; i++) {
                container.appendChild(createBtn(i, i === currentPage, false, () => { currentPage = i; displayProducts(); window.scrollTo({top:0, behavior:'smooth'}); }));
            }
            
            container.appendChild(createBtn('‚Üí', false, currentPage === pages, () => { currentPage++; displayProducts(); window.scrollTo({top:0, behavior:'smooth'}); }));
        }

        function handleSearch() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            let found = false;
            cards.forEach(c => {
                const match = c.innerText.toLowerCase().includes(term);
                c.classList.toggle('hidden', !match);
                if (match) found = true;
            });
            document.getElementById('searchError').classList.toggle('hidden', found);
        }
    </script>
</body>
</html>