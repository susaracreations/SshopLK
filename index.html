
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://autographmarquisbuffet.com/a2/b9/04/a2b9045cac06f56734485a0391921509.js"></script>
    <meta name="monetag" content="616292c5e9fbf9a008bd167b15a530dd">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S Shop LK - Your Gaming & Digital Marketplace</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/7JWLrP7v/sshoplk-favicon.webp">
    <link rel="shortcut icon" type="image/png" href="https://i.ibb.co/7JWLrP7v/sshoplk-favicon.webp">
    <script src="favicon.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Rate Limiting Configuration -->
    <script src="rate-limit-config.js"></script>
    <!-- Status Monitor -->
    <script src="status-monitor.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Dark blue background */
            color: #e2e8f0; /* Light gray text */
        }
        /* Custom scrollbar for a cleaner look on the dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
        
        /* Line clamp utility for truncating text */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-clamp: 2;
        }
        
        /* Mobile header scroll behavior */
        @media (max-width: 768px) {
            header {
                transition: background-color 0.3s ease-in-out, backdrop-filter 0.3s ease-in-out;
            }
            
            header.header-scrolled {
                background-color: rgba(15, 23, 42, 0.8); /* bg-slate-900 with 80% opacity */
                backdrop-filter: blur(8px);
            }
        }

        /* Autocomplete styles */
        .suggestion-item {
            transition: background-color 0.2s ease;
        }
        .suggestion-item:hover {
            background-color: #334155;
        }
        .suggestion-item.selected {
            background-color: #475569;
            color: #fff;
        }

        /* Animated background for hero section */
        @keyframes move-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animated-hero-bg {
            background: linear-gradient(-45deg, #1e3a8a, #3b0764, #0f172a, #4c1d95);
            background-size: 400% 400%;
            animation: move-bg 20s ease infinite;
        }

        /* Accessibility: Reduce motion for users who prefer it */
        @media (prefers-reduced-motion: reduce) {
            .animated-hero-bg {
                animation: none;
            }
        }

        /* Loading Screen Animations */
        @keyframes gradient-x {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .animate-gradient-x {
            animation: gradient-x 3s ease infinite;
        }
    </style>
</head>
      <script>        
        window.Chat("boot", {
          app_id: "jk23SrqsJ",
        });
      </script>
<body class="flex flex-col min-h-screen">

    <!-- Ultra Modern Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-[#0f172a] transition-opacity duration-700 ease-out">
        <div class="relative mb-8">
            <!-- Glowing Background Blur -->
            <div class="absolute inset-0 bg-blue-600/20 blur-3xl rounded-full animate-pulse"></div>
            
            <!-- Outer Ring -->
            <div class="relative w-24 h-24">
                <div class="absolute inset-0 rounded-full border-4 border-slate-700"></div>
                <div class="absolute inset-0 rounded-full border-t-4 border-blue-500 shadow-[0_0_20px_rgba(59,130,246,0.5)] animate-[spin_1s_linear_infinite]"></div>
            </div>
            
            <!-- Inner Ring -->
            <div class="absolute inset-0 m-auto w-16 h-16">
                <div class="absolute inset-0 rounded-full border-4 border-slate-700"></div>
                <div class="absolute inset-0 rounded-full border-r-4 border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.5)] animate-[spin_1.5s_linear_infinite_reverse]"></div>
            </div>

            <!-- Center Icon -->
            <div class="absolute inset-0 flex items-center justify-center">
                <svg class="w-8 h-8 text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.8)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
        </div>

        <!-- Loading Text -->
        <div class="text-center z-10">
            <h2 class="text-2xl font-black tracking-[0.2em] text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400 animate-gradient-x bg-[length:200%_auto]">
                S SHOP LK
            </h2>
            <div class="flex justify-center space-x-1.5 mt-4">
                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.3s]"></div>
                <div class="w-2 h-2 bg-purple-500 rounded-full animate-bounce [animation-delay:-0.15s]"></div>
                <div class="w-2 h-2 bg-cyan-500 rounded-full animate-bounce"></div>
            </div>
        </div>
    </div>

    <!-- Replace header -->
    <div id="header-container"></div>

    <!-- Chat Link (Fixed Position) -->
    

    <!-- Hero Section -->
    <section id="heroSection" aria-labelledby="hero-heading" class="animated-hero-bg text-white py-16 md:py-28 relative overflow-hidden">
        <!-- Background Image Overlay -->
        <div id="heroBackgroundImage" class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20 hidden"></div>
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
        
        <div class="container mx-auto px-4 flex flex-col lg:flex-row items-center justify-between space-y-6 lg:space-y-0 lg:space-x-10 relative z-10">
            <!-- Left side: Text and Search -->
            <div class="flex-1 text-center lg:text-left">
                <h1 id="hero-heading" class="text-4xl md:text-6xl font-extrabold tracking-tight mb-4 leading-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-300" style="text-shadow: 0 0 20px rgba(196, 181, 253, 0.3);">
                    Your Digital Marketplace<br>Starts Here.
                </h1>
                <p class="text-lg md:text-xl text-gray-200 mb-8">
                    Your one-stop shop for the best digital products and gaming services in Sri Lanka.
                </p>
                <form role="search" onsubmit="handleSearch(); return false;" class="max-w-xl mx-auto lg:mx-0 relative">
                    <div class="flex items-center bg-white/10 backdrop-blur-md rounded-full p-2 shadow-lg border border-white/20 focus-within:ring-2 focus-within:ring-blue-400 transition-all">
                        <input type="text" id="searchInput" placeholder="Search for products..." aria-label="Search for products" class="flex-grow px-4 py-2 bg-transparent text-white focus:outline-none placeholder-gray-300" autocomplete="off">
                        <button type="submit" aria-label="Submit search" class="bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-full transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-blue-400">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    <!-- Autocomplete suggestions container -->
                    <div id="autocomplete-suggestions" role="listbox" class="absolute mt-2 w-full bg-slate-800/90 backdrop-blur-md rounded-xl shadow-lg border border-slate-700 z-50 hidden max-h-72 overflow-y-auto">
                        <!-- Suggestions will be injected here -->
                    </div>
                </form>
                <!-- Trust Badges -->
                <div class="flex flex-col sm:flex-row items-center justify-center lg:justify-start space-y-4 sm:space-y-0 sm:space-x-8 mt-8 text-sm text-gray-300">
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944c-2.88 0-5.591 1.11-7.618 3.116A12.03 12.03 0 002 12c0 3.018 1.12 5.86 3.116 7.882A11.955 11.955 0 0112 21.056c2.88 0 5.591-1.11 7.618-3.116A12.03 12.03 0 0022 12c0-3.018-1.12-5.86-3.116-7.882z" />
                        </svg>
                        <span>Secure Shopping</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Trusted by Millions</span>
                    </div>
                </div>
            </div>

            <!-- Right side: Mascot Image (Optional) -->
            <div id="heroImageContainer" class="flex-1 flex justify-center lg:justify-end group" role="region" aria-label="Featured Content Carousel">
                <!-- Hero image carousel with auto-fading -->
                <div id="heroCarousel" class="relative w-full max-w-xs sm:max-w-sm md:max-w-lg h-48 sm:h-64 md:h-80 rounded-2xl shadow-2xl overflow-hidden bg-white/10 backdrop-blur-lg border border-white/20">
                    <div id="heroImageInnerContainer" class="w-full h-full relative">
                        <!-- Images will be loaded dynamically -->
                    </div>
                    <!-- Carousel indicators -->
                    <div id="carouselIndicators" role="tablist" aria-label="Carousel Slides" class="absolute bottom-3 sm:bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                        <!-- Indicators will be added dynamically -->
                    </div>
                    <!-- Navigation arrows -->
                    <button id="prevButton" aria-label="Previous slide" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/40 text-white p-2 rounded-full hover:bg-black/60 transition-all duration-300 opacity-0 group-hover:opacity-100 focus:opacity-100">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <button id="nextButton" aria-label="Next slide" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/40 text-white p-2 rounded-full hover:bg-black/60 transition-all duration-300 opacity-0 group-hover:opacity-100 focus:opacity-100">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-8 md:py-16">
        
        <!-- Featured Products Section -->
        <section id="featured-products-section" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-white">New Arrivals</h2>
                <a href="products.html" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                    View All Products
                </a>
            </div>
            
            <div id="featured-product-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Featured product cards will be loaded here -->
            </div>
        </section>

        <!-- New Buyer-Focused CTA Section -->
        <section class="my-16 md:my-24" aria-labelledby="cta-heading">
            <div class="relative overflow-hidden rounded-3xl bg-slate-900/50 border border-slate-700/50 p-8 md:p-12 backdrop-blur-xl">
                <!-- Animated background gradient -->
                <div aria-hidden="true" class="absolute -top-1/2 -left-1/2 w-[200%] h-[200%] bg-gradient-to-br from-purple-600/20 via-blue-600/20 to-transparent animate-[spin_20s_linear_infinite]"></div>
                
                <div class="relative z-10 grid grid-cols-1 lg:grid-cols-5 gap-12 items-center">
                    <!-- Left Side: Text Content -->
                    <div class="lg:col-span-3 text-center lg:text-left">
                        <h2 id="cta-heading" class="text-4xl lg:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-300 mb-6 leading-tight" style="text-shadow: 0 0 20px rgba(196, 181, 253, 0.3);">
                                Ready to Dive In?
                            </h2>
                            <p class="text-xl text-gray-200 mb-8 leading-relaxed max-w-2xl mx-auto lg:mx-0">
                                Explore our curated collection of digital goods and find your next favorite game or software. Your adventure starts now.
                            </p>
                            
                            <!-- Call-to-Action Buttons -->
                            <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
                                <a href="products.html" class="bg-blue-600 text-white px-8 py-4 rounded-full font-bold text-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105 shadow-lg shadow-blue-900/50 text-center">
                                    Browse Products
                                </a>
                                <a href="learn-more.html" class="border-2 border-white/50 text-white px-8 py-4 rounded-full font-bold text-lg hover:bg-white/10 hover:border-white transition-all duration-300 transform hover:scale-105 text-center">
                                    How It Works
                                </a>
                            </div>
                        </div>
                        
                        <!-- Right Side: Creative Visual -->
                        <div class="lg:col-span-2 relative flex items-center justify-center min-h-[250px] sm:min-h-[300px] lg:min-h-full">
                            <!-- Outer Ring -->
                            <div class="absolute w-full max-w-xs sm:max-w-sm aspect-square border-2 border-blue-500/20 rounded-full animate-[spin_40s_linear_infinite]">
                                <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 p-2 bg-slate-800/80 rounded-full border border-slate-700 backdrop-blur-sm">
                                    <svg class="w-6 h-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7" /></svg>
                                </div>
                                <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 p-2 bg-slate-800/80 rounded-full border border-slate-700 backdrop-blur-sm">
                                    <svg class="w-6 h-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </div>
                            </div>
                            <!-- Inner Ring -->
                            <div class="absolute w-2/3 max-w-[200px] sm:max-w-xs aspect-square border-2 border-purple-500/20 rounded-full animate-[spin_30s_linear_infinite_reverse]">
                                <div class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 p-2 bg-slate-800/80 rounded-full border border-slate-700 backdrop-blur-sm">
                                    <svg class="w-6 h-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>
                                </div>
                                <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 p-2 bg-slate-800/80 rounded-full border border-slate-700 backdrop-blur-sm">
                                    <svg class="w-6 h-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </div>
                            </div>
                            <!-- Central Element -->
                            <div class="relative w-32 h-32 sm:w-40 sm:h-40 bg-slate-800/50 rounded-full flex items-center justify-center backdrop-blur-lg border border-slate-700 shadow-2xl">
                                <svg class="w-12 h-12 sm:w-16 sm:h-16 text-white drop-shadow-[0_0_15px_rgba(59,130,246,0.6)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Categories Section -->
        <section>
            <h2 class="text-3xl font-bold mb-8 text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-300">Browse by Category</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Category Card 1: Games -->
                <a href="category-games.html" aria-label="Browse Games category" class="group bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center transition-all duration-300 hover:border-blue-500/50 hover:shadow-blue-500/20 hover:-translate-y-2">
                    <div class="w-16 h-16 text-blue-400 mb-4 transition-transform duration-300 group-hover:scale-110">
                        <svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 group-hover:text-blue-300 transition-colors">Games</h3>
                    <p class="text-sm text-gray-400">Gaming accounts, in-game items, and gaming services.</p>
                </a>

                <!-- Category Card 2: Software & Apps -->
                <a href="category-software-apps.html" aria-label="Browse Software and Apps category" class="group bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center transition-all duration-300 hover:border-blue-500/50 hover:shadow-blue-500/20 hover:-translate-y-2">
                    <div class="w-16 h-16 text-blue-400 mb-4 transition-transform duration-300 group-hover:scale-110">
                        <svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 group-hover:text-blue-300 transition-colors">Software & Apps</h3>
                    <p class="text-sm text-gray-400">Software licenses, app subscriptions, and digital tools.</p>
                </a>
                
                <!-- Category Card 3: Boosting & Coaching -->
                <a href="category-boosting-coaching.html" aria-label="Browse Boosting and Coaching category" class="group bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center transition-all duration-300 hover:border-blue-500/50 hover:shadow-blue-500/20 hover:-translate-y-2">
                    <div class="w-16 h-16 text-blue-400 mb-4 transition-transform duration-300 group-hover:scale-110">
                        <svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v14H9z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 group-hover:text-blue-300 transition-colors">Boosting & Coaching</h3>
                    <p class="text-sm text-gray-400">Improve your skills with professional player coaching.</p>
                </a>

                <!-- Category Card 4: Gift Cards -->
                <a href="category-gift-cards.html" aria-label="Browse Gift Cards category" class="group bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center transition-all duration-300 hover:border-blue-500/50 hover:shadow-blue-500/20 hover:-translate-y-2">
                    <div class="w-16 h-16 text-blue-400 mb-4 transition-transform duration-300 group-hover:scale-110">
                        <svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 group-hover:text-blue-300 transition-colors">Gift Cards</h3>
                    <p class="text-sm text-gray-400">Digital gift cards for various gaming platforms.</p>
                </a>
            </div>
        </section>

    </main>

<!-- Keep your main content here -->

<!-- Replace footer -->
<div id="footer-container"></div>

    <!-- Buy Now Modal (Pop-up Panel) -->
    <div id="buyNowModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" class="fixed inset-0 bg-gray-950 bg-opacity-75 flex items-center justify-center z-[1000] p-4 hidden">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6 md:p-8 w-full max-w-sm text-center border-2 border-blue-600 relative">
            <!-- Close Button -->
            <button aria-label="Close modal" class="absolute top-4 right-4 text-gray-400 hover:text-white" onclick="closeModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <h3 class="text-2xl font-bold mb-2 text-white" id="modalTitle">How would you like to buy?</h3>
            <p class="text-gray-400 mb-6" id="modalDescription">Contact us to complete your purchase of "<span id="productNameInModal" class="font-semibold text-white">Product Name</span>".</p>
            
            <div class="flex flex-col space-y-4">
                <!-- WhatsApp Button -->
                <a href="#" id="whatsappLink" class="flex items-center justify-center space-x-2 bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors duration-300">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/512px-WhatsApp.svg.png" alt="WhatsApp Icon" class="h-6 w-6">
                    <span>Buy on WhatsApp</span>
                </a>

                <!-- Discord Button -->
                <a href="#" id="discordLink" class="flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300">
                    <img src="https://cdn-icons-png.flaticon.com/512/4945/4945973.png" alt="Discord Icon" class="h-6 w-6">
                    <span>Buy on Discord</span>
                </a>
            </div>
        </div>
    </div>
    <!-- End of Buy Now Modal -->

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<!-- Header Component Script -->
<script src="header-component.js"></script>

<!-- Footer Component Script -->
<script src="footer-component.js"></script>

<!-- Page-specific JavaScript -->
    <script>
    let products = [];
    let currentCategory = 'all';

    // Load products on page load
    window.addEventListener('load', function() {
        // Handle Loading Screen
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            setTimeout(() => {
                loadingScreen.classList.add('opacity-0', 'pointer-events-none');
                // Remove from DOM after transition
                setTimeout(() => loadingScreen.remove(), 700);
            }, 1000); // Show for at least 1 second
        }

        // Wait for Firebase to be ready before initializing the page
        waitForFirebaseReady(() => {
            initializePage();
        });
        setupKeyboardShortcuts();
        setupAutocomplete();
    });

    // Handle search input
    function handleSearch() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput.value.trim() !== '') {
            window.location.href = `products.html?search=${encodeURIComponent(searchInput.value.trim())}`;
        }
    }

    // Function to wait for Firebase to be initialized
    function waitForFirebaseReady(callback) {
        const checkInterval = setInterval(() => {
            if (window.FirebaseService && typeof window.FirebaseService.getProducts === 'function') {
                clearInterval(checkInterval);
                callback();
            }
        }, 100); // Check every 100ms
    }

    // Autocomplete functionality
    function setupAutocomplete() {
        const searchInput = document.getElementById('searchInput');
        const suggestionsContainer = document.getElementById('autocomplete-suggestions');
        let selectedSuggestionIndex = -1;

        searchInput.addEventListener('input', function() {
            const query = this.value.trim().toLowerCase();
            if (query.length < 2) {
                suggestionsContainer.innerHTML = '';
                suggestionsContainer.classList.add('hidden');
                return;
            }

            const matchedProducts = products.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.description.toLowerCase().includes(query)
            ).slice(0, 5); // Limit to 5 suggestions

            if (matchedProducts.length > 0) {
                suggestionsContainer.innerHTML = matchedProducts.map((product, index) => `
                    <a href="dynamic-product-detail.html?id=${product.id}" class="suggestion-item p-3 cursor-pointer flex items-center space-x-3" data-index="${index}">
                        <img src="${product.image}" alt="${product.name}" class="w-10 h-10 object-cover rounded-md">
                        <div>
                            <p class="text-white font-semibold">${product.name}</p>
                            <p class="text-gray-400 text-xs">LKR ${product.price.toLocaleString()}</p>
                        </div>
                    </a>
                `).join('');
                suggestionsContainer.classList.remove('hidden');
            } else {
                suggestionsContainer.innerHTML = '<div class="p-3 text-gray-400">No products found.</div>';
                suggestionsContainer.classList.remove('hidden');
            }
            selectedSuggestionIndex = -1; // Reset selection
        });

        searchInput.addEventListener('keydown', function(e) {
            const suggestions = suggestionsContainer.querySelectorAll('.suggestion-item');
            if (!suggestions || suggestions.length === 0) return;

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                selectedSuggestionIndex = (selectedSuggestionIndex + 1) % suggestions.length;
                updateSelection(suggestions);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                selectedSuggestionIndex = (selectedSuggestionIndex - 1 + suggestions.length) % suggestions.length;
                updateSelection(suggestions);
            } else if (e.key === 'Enter') {
                if (selectedSuggestionIndex > -1) {
                    e.preventDefault();
                    suggestions[selectedSuggestionIndex].click(); // This will now navigate due to the <a> tag
                } else {
                    handleSearch();
                }
                suggestionsContainer.classList.add('hidden');
            }
        });

        function updateSelection(suggestions) {
            suggestions.forEach((item, index) => {
                if (index === selectedSuggestionIndex) {
                    item.classList.add('selected');
                    item.scrollIntoView({ block: 'nearest' });
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // Close suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                suggestionsContainer.classList.add('hidden');
            }
        });
    }

    // Override handleSearch to also hide suggestions
    function handleSearch() {
        const searchInput = document.getElementById('searchInput');
        const suggestionsContainer = document.getElementById('autocomplete-suggestions');
        if (searchInput.value.trim() !== '') {
            window.location.href = `products.html?search=${encodeURIComponent(searchInput.value.trim())}`;
        }
        suggestionsContainer.classList.add('hidden');
    }

    // Setup keyboard shortcuts for admin panel access
    function setupKeyboardShortcuts() {
        document.addEventListener('keydown', function(event) {
            // Ctrl + Alt + A (Windows/Linux) or Cmd + Alt + A (Mac)
            if ((event.ctrlKey || event.metaKey) && event.altKey && event.key === 'a') {
                event.preventDefault(); // Prevent default browser action
                window.location.href = 'admin-login.html';
            }
            
            // Ctrl + Alt + S (Windows/Linux) or Cmd + Alt + S (Mac)
            if ((event.ctrlKey || event.metaKey) && event.altKey && event.key === 's') {
                event.preventDefault(); // Prevent default browser action
                window.location.href = 'admin.html';
            }
        });
    }

    // Wait for Firebase to be fully loaded
    function waitForFirebase() {
        if (window.auth && window.AuthService) {
            console.log('Firebase is ready, initializing Google sign-in');
            initializeGoogleSignIn();
        } else {
            console.log('Waiting for Firebase to initialize...');
            setTimeout(waitForFirebase, 100);
        }
    }
    
    // Prevent multiple rapid page loads
    let pageLoadCount = 0;
    const MAX_LOADS_PER_MINUTE = 10;
    
    function checkPageLoadRate() {
        const now = Date.now();
        const oneMinuteAgo = now - (60 * 1000);
        
        // Clean old entries
        pageLoadCount = Math.max(0, pageLoadCount - 1);
        
        if (pageLoadCount >= MAX_LOADS_PER_MINUTE) {
            console.warn('Page load rate limit exceeded. Using cached data.');
            return false;
        }
        
        pageLoadCount++;
        return true;
    }
    
    // Cache warming mechanism
    function warmCache() {
        // Pre-load essential data to localStorage if not already present
        if (!localStorage.getItem('sShopProducts')) {
            fetch('products.json')
                .then(response => response.json())
                .then(data => {
                    localStorage.setItem('sShopProducts', JSON.stringify(data.products));
                    console.log('Cache warmed with products.json data');
                })
                .catch(error => {
                    console.warn('Failed to warm cache with products.json:', error);
                });
        }
        
        // Set default hero images if not present
        if (!localStorage.getItem('sShopHeroImages')) {
            const defaultImages = [
                {
                    url: 'https://placehold.co/600x400/805ad5/ffffff?text=S+Shop+LK',
                    alt: 'S Shop LK Hero 1',
                    title: 'Welcome to S Shop LK'
                },
                {
                    url: 'https://placehold.co/600x400/667eea/ffffff?text=Gaming+Products',
                    alt: 'S Shop LK Hero 2',
                    title: 'Gaming Products'
                },
                {
                    url: 'https://placehold.co/600x400/764ba2/ffffff?text=Best+Deals',
                    alt: 'S Shop LK Hero 3',
                    title: 'Best Deals'
                }
            ];
            localStorage.setItem('sShopHeroImages', JSON.stringify(defaultImages));
            console.log('Cache warmed with default hero images');
        }
    }
    
    // Initialize page with rate limiting
    function initializePage() {
        // Warm cache first
        warmCache();
        
        if (!checkPageLoadRate()) {
            // Use cached data if rate limit exceeded
            loadHeroImagesFromLocalStorage();
            loadHeroBackgroundImageFromLocalStorage();
            toggleHeroImageVisibilityFromLocalStorage();
            initializeCarousel();
            loadFromLocalStorage();
            return;
        }
        
        // Normal initialization
        loadHeroImages();
        loadProducts();
    }

    // Hero Image Carousel Variables
    let heroImages = [];
    let currentImageIndex = 0;
    let carouselInterval;
    let isAutoPlaying = true;
    
    // Rate limiting variables
    let lastFirebaseCall = 0;
    const MIN_CALL_INTERVAL = 2000; // 2 seconds between Firebase calls
    let isInitializing = false;

    function loadHeroImages() {
        // Prevent multiple simultaneous calls
        if (isInitializing) return;
        isInitializing = true;
        
        // Check rate limiting
        const now = Date.now();
        if (now - lastFirebaseCall < MIN_CALL_INTERVAL) {
            console.log('Rate limiting: skipping Firebase call, using cached data');
            loadHeroImagesFromLocalStorage();
            loadHeroBackgroundImageFromLocalStorage();
            toggleHeroImageVisibilityFromLocalStorage();
            initializeCarousel();
            isInitializing = false;
            return;
        }
        
        // Try to load from Firebase first
        if (window.FirebaseService) {
            lastFirebaseCall = now;
            safeFirebaseCall(
                () => FirebaseService.getWebsiteSettings(),
                () => {
                    loadHeroImagesFromLocalStorage();
                    loadHeroBackgroundImageFromLocalStorage();
                    toggleHeroImageVisibilityFromLocalStorage();
                    initializeCarousel();
                    return null;
                }
            ).then(settings => {
                if (settings && settings.heroImages && settings.heroImages.length > 0) {
                    heroImages = settings.heroImages;
                    console.log('Loaded hero images from Firebase:', heroImages);
                } else {
                    loadHeroImagesFromLocalStorage();
                }
                
                // Load background image
                if (settings && settings.heroBackgroundImage) {
                    loadHeroBackgroundImage(settings.heroBackgroundImage);
                } else {
                    loadHeroBackgroundImageFromLocalStorage();
                }
                
                // Handle hero image visibility
                if (settings && settings.showHeroImages !== undefined) {
                    toggleHeroImageVisibility(settings.showHeroImages);
                } else {
                    toggleHeroImageVisibilityFromLocalStorage();
                }
                
                initializeCarousel();
                isInitializing = false;
            }).catch(error => {
                console.error('Error loading hero images from Firebase:', error);
                loadHeroImagesFromLocalStorage();
                loadHeroBackgroundImageFromLocalStorage();
                toggleHeroImageVisibilityFromLocalStorage();
                initializeCarousel();
                isInitializing = false;
            });
        } else {
            loadHeroImagesFromLocalStorage();
            loadHeroBackgroundImageFromLocalStorage();
            toggleHeroImageVisibilityFromLocalStorage();
            initializeCarousel();
            isInitializing = false;
        }
    }

    function loadHeroBackgroundImage(backgroundImageUrl) {
        const backgroundElement = document.getElementById('heroBackgroundImage');
        if (backgroundImageUrl) {
            if (typeof backgroundImageUrl === 'string') {
                // Legacy format - just URL string
                backgroundElement.style.backgroundImage = `url('${backgroundImageUrl}')`;
                backgroundElement.style.opacity = '0.2'; // Default 20% opacity
                backgroundElement.classList.remove('hidden');
                console.log('Loaded hero background image from Firebase (legacy format):', backgroundImageUrl);
            } else {
                // New format - object with URL and opacity
                backgroundElement.style.backgroundImage = `url('${backgroundImageUrl.url}')`;
                backgroundElement.style.opacity = (backgroundImageUrl.opacity / 100).toString();
                backgroundElement.classList.remove('hidden');
                console.log('Loaded hero background image from Firebase:', backgroundImageUrl);
            }
        } else {
            backgroundElement.classList.add('hidden');
        }
    }

    function loadHeroBackgroundImageFromLocalStorage() {
        const backgroundImageData = localStorage.getItem('sShopHeroBackgroundImage');
        if (backgroundImageData) {
            try {
                const settings = JSON.parse(backgroundImageData);
                if (typeof settings === 'string') {
                    // Legacy format - just URL string
                    loadHeroBackgroundImage(settings);
                    console.log('Loaded hero background image from localStorage (legacy format):', settings);
                } else {
                    // New format - object with URL and opacity
                    loadHeroBackgroundImage(settings);
                    console.log('Loaded hero background image from localStorage:', settings);
                }
            } catch (error) {
                // Fallback to legacy format
                loadHeroBackgroundImage(backgroundImageData);
                console.log('Loaded hero background image from localStorage (fallback):', backgroundImageData);
            }
        }
    }

    function toggleHeroImageVisibility(show) {
        const heroImageContainer = document.getElementById('heroImageContainer');
        if (show && heroImages.length > 0) {
            // Show on all screen sizes
            heroImageContainer.className = 'flex-1 flex justify-center lg:justify-end';
            console.log('Hero images are visible on all screen sizes');
            // Reinitialize carousel after making it visible
            setTimeout(() => {
                initializeCarousel();
            }, 100);
        } else {
            // Hide on all screen sizes
            heroImageContainer.className = 'flex-1 flex justify-center lg:justify-end hidden';
            console.log('Hero images are hidden on all screen sizes');
            // Stop auto-play when hidden
            if (carouselInterval) {
                clearInterval(carouselInterval);
            }
        }
    }

    function toggleHeroImageVisibilityFromLocalStorage() {
        const showHeroImages = localStorage.getItem('sShopShowHeroImages');
        if (showHeroImages !== null) {
            toggleHeroImageVisibility(showHeroImages === 'true');
        } else {
            // Default to showing if images exist
            toggleHeroImageVisibility(heroImages.length > 0);
        }
    }

    function loadHeroImagesFromLocalStorage() {
        const storedImages = localStorage.getItem('sShopHeroImages');
        if (storedImages) {
            heroImages = JSON.parse(storedImages);
            console.log('Loaded hero images from localStorage:', heroImages);
        } else {
            // Default images if none are set
            heroImages = [
                {
                    url: 'https://placehold.co/600x400/805ad5/ffffff?text=S+Shop+LK',
                    alt: 'S Shop LK Hero 1',
                    title: 'Welcome to S Shop LK'
                },
                {
                    url: 'https://placehold.co/600x400/667eea/ffffff?text=Gaming+Products',
                    alt: 'S Shop LK Hero 2',
                    title: 'Gaming Products'
                },
                {
                    url: 'https://placehold.co/600x400/764ba2/ffffff?text=Best+Deals',
                    alt: 'S Shop LK Hero 3',
                    title: 'Best Deals'
                }
            ];
            console.log('Using default hero images:', heroImages);
        }
    }

    function initializeCarousel() {
        if (heroImages.length === 0) return;

        const heroContainer = document.getElementById('heroImageContainer');
        const container = document.getElementById('heroImageInnerContainer');
        const indicators = document.getElementById('carouselIndicators');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');

        // Check if elements exist and hero container is visible
        if (!container || !indicators || !prevButton || !nextButton) {
            console.error('Carousel elements not found');
            return;
        }

        // Only initialize if hero container is visible
        if (heroContainer.classList.contains('hidden')) {
            console.log('Hero container is hidden, skipping carousel initialization');
            return;
        }

        // Clear existing content
        container.innerHTML = '';
        indicators.innerHTML = '';

        // Create image elements
        heroImages.forEach((image, index) => {
            const imgElement = document.createElement('img');
            imgElement.src = image.url || 'https://placehold.co/600x400/805ad5/ffffff?text=Image+Missing';
            imgElement.alt = image.title || image.alt || `Featured content ${index + 1}`;
            imgElement.className = `absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ${index === 0 ? 'opacity-100' : 'opacity-0'}`;
            imgElement.onerror = function() {
                this.src = 'https://placehold.co/600x400/805ad5/ffffff?text=Image+Error';
            };
            container.appendChild(imgElement);

            // Create indicator
            const indicator = document.createElement('button');
            indicator.setAttribute('role', 'tab');
            indicator.setAttribute('aria-selected', index === 0 ? 'true' : 'false');
            indicator.className = `w-2 h-2 sm:w-3 sm:h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-white' : 'bg-white bg-opacity-50'}`;
            indicator.setAttribute('aria-label', `Go to slide ${index + 1}`);
            indicator.onclick = () => goToImage(index);
            indicators.appendChild(indicator);
        });

        // Setup navigation buttons
        prevButton.onclick = () => previousImage();
        nextButton.onclick = () => nextImage();

        // Setup hover effects for navigation buttons (desktop only)
        const carousel = document.getElementById('heroCarousel');
        if (carousel) {
            // Only add hover effects on desktop (md and larger)
            const mediaQuery = window.matchMedia('(min-width: 768px)');
            
            if (mediaQuery.matches) {
            carousel.addEventListener('mouseenter', () => {
                prevButton.classList.remove('opacity-0');
                nextButton.classList.remove('opacity-0');
                pauseAutoPlay();
            });
            carousel.addEventListener('mouseleave', () => {
                prevButton.classList.add('opacity-0');
                nextButton.classList.add('opacity-0');
                resumeAutoPlay();
            });
            }
            // On mobile, buttons are already visible by default (opacity-100)
        }

        // Start auto-play
        startAutoPlay();
    }

    function showImage(index) {
        const images = document.querySelectorAll('#heroImageInnerContainer img');
        const indicators = document.querySelectorAll('#carouselIndicators button');

        // Hide all images
        images.forEach(img => img.classList.add('opacity-0'));
        indicators.forEach(indicator => {
            indicator.classList.remove('bg-white');
            indicator.classList.add('bg-white', 'bg-opacity-50');
            indicator.setAttribute('aria-selected', 'false');
        });

        // Show current image
        if (images[index]) {
            images[index].classList.remove('opacity-0');
            indicators[index].classList.remove('bg-opacity-50');
            indicators[index].setAttribute('aria-selected', 'true');
        }

        currentImageIndex = index;
    }

    function nextImage() {
        const nextIndex = (currentImageIndex + 1) % heroImages.length;
        showImage(nextIndex);
    }

    function previousImage() {
        const prevIndex = (currentImageIndex - 1 + heroImages.length) % heroImages.length;
        showImage(prevIndex);
    }

    function goToImage(index) {
        showImage(index);
    }

    function startAutoPlay() {
        if (carouselInterval) clearInterval(carouselInterval);
        carouselInterval = setInterval(() => {
            if (isAutoPlaying) {
                nextImage();
            }
        }, 4000); // Change image every 4 seconds
    }

    function pauseAutoPlay() {
        isAutoPlaying = false;
    }

    function resumeAutoPlay() {
        isAutoPlaying = true;
    }

    function loadProducts() {
        // Check rate limiting
        const now = Date.now();
        if (now - lastFirebaseCall < MIN_CALL_INTERVAL) {
            console.log('Rate limiting: skipping Firebase call, using cached data');
            loadFromLocalStorage();
            return;
        }
        
        // Try to load from Firebase first
        if (window.FirebaseService) {
            lastFirebaseCall = now;
            safeFirebaseCall(
                () => FirebaseService.getProducts(),
                () => {
                    loadFromLocalStorage();
                    return [];
                }
            ).then(firebaseProducts => {
                if (firebaseProducts && firebaseProducts.length > 0) {
                    products = firebaseProducts;
                    displayProducts();
                    console.log('Loaded products from Firebase:', products);
                } else {
                    // Fallback to localStorage if no Firebase data
                    loadFromLocalStorage();
                }
            }).catch(error => {
                console.error('Error loading from Firebase:', error);
                loadFromLocalStorage();
            });
        } else {
            loadFromLocalStorage();
        }
    }

    function loadFromLocalStorage() {
        const storedProducts = localStorage.getItem('sShopProducts');
        if (storedProducts) {
            products = JSON.parse(storedProducts);
            console.log('Loaded products from localStorage:', products);
            displayProducts();
        } else {
            // If no products in Firebase or localStorage, show an empty state.
            console.warn('No products found in Firebase or localStorage.');
            products = [];
            displayProducts();
        }
    }
    
    
    function displayProducts() {
        const featuredContainer = document.getElementById('featured-product-container');
        featuredContainer.innerHTML = '';

        if (window.FirebaseService) {
            // Fetch top 4 newest products directly from Firebase
            FirebaseService.getNewestProducts(4)
                .then(featuredProducts => {
                    renderFeaturedProducts(featuredProducts);
                })
                .catch(error => {
                    console.error("Error fetching featured products from Firebase:", error);
                    // Fallback to local products array
                    const localFeatured = getLocalFeaturedProducts(4);
                    renderFeaturedProducts(localFeatured);
                });
        } else {
            // Fallback if Firebase is not available
            const localFeatured = getLocalFeaturedProducts(4);
            renderFeaturedProducts(localFeatured);
        }
    }

    function renderFeaturedProducts(featuredProducts) {
        const featuredContainer = document.getElementById('featured-product-container');
        featuredContainer.innerHTML = '';

        if (featuredProducts.length === 0) {
            featuredContainer.innerHTML = `<p class="text-center text-gray-400 col-span-full">No featured products to display yet.</p>`;
            return;
        }

        featuredProducts.forEach(product => {
            const productCard = document.createElement('div');
            productCard.className = 'product-card group relative bg-slate-800 rounded-xl shadow-lg overflow-hidden border border-slate-700 transition-all duration-300 hover:shadow-blue-500/20 hover:-translate-y-1';
            
            // Determine detail page based on product ID
            let detailPage = 'dynamic-product-detail.html?id=' + product.id;
            const isSoldOut = !product.availability || product.availability <= 0;

            productCard.innerHTML = `
                <div class="relative">
                    <a href="${detailPage}">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105 ${isSoldOut ? 'opacity-50' : ''}">
                    </a>
                    ${isSoldOut ? `<div class="absolute top-3 right-3 bg-red-600/90 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg">SOLD OUT</div>` : ''}
                    <div class="absolute top-3 left-3 bg-black/50 text-white text-xs font-semibold px-2 py-1 rounded-full backdrop-blur-sm">${product.category || 'General'}</div>
                </div>
                <div class="p-4 flex flex-col h-[calc(100%-12rem)]">
                    <h3 class="product-title text-lg font-bold text-white truncate mb-2 group-hover:text-blue-400 transition-colors">${product.name}</h3>
                    <p class="product-description text-sm text-gray-400 mb-4 line-clamp-2 flex-grow">${product.description}</p>
                    <div class="flex items-center justify-between mt-auto">
                        <div>
                            <span class="text-2xl font-extrabold text-blue-400">LKR ${product.price.toLocaleString()}</span>
                            <p class="text-xs text-gray-500">${product.soldCount || 0} sold</p>
                        </div>
                        <a href="${detailPage}" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-all duration-300 opacity-0 group-hover:opacity-100 transform translate-x-4 group-hover:translate-x-0">
                            View
                        </a>
                    </div>
                </div>
            `;
            featuredContainer.appendChild(productCard);
        });
    }

    function getLocalFeaturedProducts(count) {
        // Sort by createdAt if available, otherwise just take the first few
        const sorted = products.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
        return sorted.slice(0, count);
    }
        
        /**
         * This function shows the buy now modal with the specified product name.
         * @param {string} productName The name of the product being purchased.
         */
        function showBuyNowModal(productName) {
            const modal = document.getElementById('buyNowModal');
            const productNameSpan = document.getElementById('productNameInModal');
            const whatsappLink = document.getElementById('whatsappLink');
            const discordLink = document.getElementById('discordLink');

            productNameSpan.textContent = productName;
            
            // Fetch settings from Firebase to get the latest contact info
            if (window.FirebaseService) {
                FirebaseService.getWebsiteSettings().then(settings => {
                    const whatsappNumber = settings.phoneNumber || '+94767854069';
                    const discordUrl = settings.discordLink || 'https://discord.gg/nsz5SFhXMh';
                    
                    const whatsappMessage = encodeURIComponent(`Hello, I would like to buy: ${productName}`);
                    whatsappLink.href = `https://wa.me/${whatsappNumber.replace(/\s/g, '')}?text=${whatsappMessage}`;
                    discordLink.href = discordUrl;
                });
            } else {
                // Fallback for when Firebase is not available
                const whatsappMessage = encodeURIComponent(`Hello, I would like to buy: ${productName}`);
                whatsappLink.href = `https://wa.me/94767854069?text=${whatsappMessage}`;
                discordLink.href = 'https://discord.gg/nsz5SFhXMh';
            }

            modal.classList.remove('hidden');
        }

        /**
         * This function closes the buy now modal.
         */
        function closeModal() {
            const modal = document.getElementById('buyNowModal');
            modal.classList.add('hidden');
        }

    function scrollToProducts() {
        const productsSection = document.querySelector('.mb-12');
        if (productsSection) {
            productsSection.scrollIntoView({ behavior: 'smooth' });
        }
        }

    function accessChat() {
        if (window.AuthService) {
            AuthService.onAuthStateChanged(function(user) {
                if (user) {
                    // User is logged in, allow access to chat 
                    window.location.href = 'chat-simple.html';
                } else {
                    // User is not logged in, redirect to login 
                    window.location.href = 'login.html';
                }
            });
        } else {
            // Firebase Auth not available, redirect to login 
            window.location.href = 'login.html';
        }
        }

    // Retry mechanism with exponential backoff
    async function retryFirebaseCall(apiCall, maxRetries = 3, baseDelay = 1000) {
        for (let attempt = 0; attempt < maxRetries; attempt++) {
            try {
                return await apiCall();
            } catch (error) {
                if (attempt === maxRetries - 1) {
                    throw error;
                }
                
                const delay = baseDelay * Math.pow(2, attempt);
                console.log(`Firebase call failed, retrying in ${delay}ms (attempt ${attempt + 1}/${maxRetries})`);
                await new Promise(resolve => setTimeout(resolve, delay));
            }
        }
    }
    
    // Safe Firebase call wrapper
    async function safeFirebaseCall(apiCall, fallback) {
        try {
            return await retryFirebaseCall(apiCall);
        } catch (error) {
            console.warn('Firebase call failed, using fallback:', error);
            return fallback();
        }
    }

    </script>
    <script type="text/javascript">window.$crisp=[];window.CRISP_WEBSITE_ID="ff46caff-2828-4393-aace-86191b624a7c";(function(){d=document;s=d.createElement("script");s.src="https://client.crisp.chat/l.js";s.async=1;d.getElementsByTagName("head")[0].appendChild(s);})();</script>
</body>
</html>
