<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S Shop LK - Your Gaming Marketplace</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/FqsbsjVB/S-shop-lk-logo.png">
    <link rel="shortcut icon" type="image/png" href="https://i.ibb.co/FqsbsjVB/S-shop-lk-logo.png">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Dark blue background */
            color: #e2e8f0; /* Light gray text */
        }
        /* Custom scrollbar for a cleaner look on the dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
        
        /* Mobile header scroll behavior */
        @media (max-width: 768px) {
            header {
                transition: transform 0.3s ease-in-out;
            }
            
            header.header-hidden {
                transform: translateY(-100%);
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header Section -->
    <header class="bg-slate-900 shadow-xl sticky top-0 z-50 border-b border-slate-700">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <!-- Left side: Logo -->
            <a href="#" class="flex items-center space-x-2">
                <svg class="h-8 w-8 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                <span class="text-2xl font-extrabold text-white">S Shop LK</span>
            </a>

            <!-- Right side: User actions -->
            <div class="flex items-center space-x-4">
                <!-- User Authentication Section -->
                <div id="authSection" class="flex items-center space-x-3">
                    <!-- Guest User (Not Logged In) -->
                    <div id="guestUser" class="flex items-center space-x-2">
                        <a href="login.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                            Sign In
                        </a>
                        <a href="login.html" class="text-gray-300 hover:text-white transition-colors">
                            Sign Up
                        </a>
                    </div>
                    
                    <!-- Logged In User -->
                    <div id="loggedInUser" class="flex items-center space-x-3 hidden">
                        <!-- User Avatar with Dropdown -->
                        <div class="relative group">
                            <div id="userAvatar" class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg cursor-pointer hover:scale-110 transition-all duration-300 shadow-lg">
                                <span id="avatarInitials">U</span>
                            </div>
                            <!-- Profile Dropdown -->
                            <div class="absolute right-0 top-12 w-48 bg-slate-800 rounded-xl shadow-2xl border border-slate-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform scale-95 group-hover:scale-100">
                                <div class="p-4 border-b border-slate-700">
                                    <div class="text-white font-semibold" id="dropdownUsername">User</div>
                                    <div class="text-gray-400 text-sm mt-1" id="dropdownEmail">user@example.com</div>
                                </div>
                                <div class="p-2">
                                    <a href="profile.html" class="flex items-center space-x-3 px-3 py-2 text-gray-300 hover:text-white hover:bg-slate-700 rounded-lg transition-colors">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                        <span>My Profile</span>
                                    </a>
                                    <button onclick="signOut()" class="w-full flex items-center space-x-3 px-3 py-2 text-red-400 hover:text-red-300 hover:bg-red-900/20 rounded-lg transition-colors">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                        </svg>
                                        <span>Sign Out</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notification and Menu Icons -->
                <a href="#" class="p-2 rounded-full hover:bg-slate-800 transition-colors duration-300">
                    <svg class="w-6 h-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                </a>
                <a href="#" class="p-2 rounded-full hover:bg-slate-800 transition-colors duration-300">
                    <svg class="w-6 h-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </a>
            </div>
        </div>
    </header>

    <!-- Hidden Admin Access Links (Invisible but clickable) -->
    <div class="fixed top-0 left-0 w-4 h-4 opacity-0 cursor-pointer" onclick="window.location.href='admin-login.html'" title="Secret Admin Access"></div>
    <div class="fixed top-0 right-0 w-4 h-4 opacity-0 cursor-pointer" onclick="window.location.href='admin-login.html'" title="Secret Admin Access"></div>

    <!-- Hero Section -->
    <div id="heroSection" class="bg-gradient-to-r from-purple-900 to-red-900 text-white py-16 md:py-24 relative overflow-hidden">
        <!-- Background Image Overlay -->
        <div id="heroBackgroundImage" class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20 hidden"></div>
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-r from-purple-900/80 to-red-900/80"></div>
        
        <div class="container mx-auto px-4 flex flex-col lg:flex-row items-center justify-between space-y-10 lg:space-y-0 lg:space-x-10 relative z-10">
            <!-- Left side: Text and Search -->
            <div class="flex-1 text-center lg:text-left">
                <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-4 leading-tight">
                    Summer deals<br>Beyond Borders
                </h1>
                <p class="text-lg md:text-xl text-gray-200 mb-8">
                    Play globally, save locally
                </p>
                <div class="max-w-xl mx-auto lg:mx-0">
                    <div class="flex items-center bg-white rounded-full p-2 shadow-lg">
                        <!-- Added onkeyup event to trigger search on 'Enter' key press -->
                        <input type="text" id="searchInput" placeholder="Search in S Shop" class="flex-grow px-4 py-2 bg-transparent text-gray-900 focus:outline-none placeholder-gray-500" onkeyup="if(event.key === 'Enter') handleSearch()">
                        <button class="bg-red-600 hover:bg-red-700 text-white font-bold p-3 rounded-full transition-colors duration-300" onclick="handleSearch()">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- Trust Badges -->
                <div class="flex items-center justify-center lg:justify-start space-x-6 mt-6 text-sm text-gray-200">
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944c-2.88 0-5.591 1.11-7.618 3.116A12.03 12.03 0 002 12c0 3.018 1.12 5.86 3.116 7.882A11.955 11.955 0 0112 21.056c2.88 0 5.591-1.11 7.618-3.116A12.03 12.03 0 0022 12c0-3.018-1.12-5.86-3.116-7.882z" />
                        </svg>
                        <span>ISO Certified Security</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-5 h-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Trusted by Millions</span>
                    </div>
                </div>
            </div>

            <!-- Right side: Mascot Image (Optional) -->
            <div id="heroImageContainer" class="flex-1 flex justify-center lg:justify-end hidden">
                <!-- Hero image carousel with auto-fading -->
                <div id="heroCarousel" class="relative w-full max-w-lg h-80 rounded-xl shadow-2xl overflow-hidden">
                    <div id="heroImageInnerContainer" class="w-full h-full relative">
                        <!-- Images will be loaded dynamically -->
                    </div>
                    <!-- Carousel indicators -->
                    <div id="carouselIndicators" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                        <!-- Indicators will be added dynamically -->
                    </div>
                    <!-- Navigation arrows -->
                    <button id="prevButton" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition-all duration-300 opacity-0 group-hover:opacity-100">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <button id="nextButton" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition-all duration-300 opacity-0 group-hover:opacity-100">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-8 md:py-16">
        
        <!-- Featured Products Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6 text-white">Featured Products</h2>
            
            <!-- Category Filter Buttons -->
            <div class="flex flex-wrap gap-4 mb-8">
                <button onclick="filterProducts('all')" id="filter-all" class="category-filter bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                    All Products
                </button>
                <button onclick="filterProducts('games')" id="filter-games" class="category-filter bg-slate-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-slate-600 transition-colors">
                    Games
                </button>
                <button onclick="filterProducts('software-apps')" id="filter-software" class="category-filter bg-slate-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-slate-600 transition-colors">
                    Software & Apps
                </button>
            </div>
            
            <!-- Container for search results and error message -->
            <div class="relative">
                <p id="searchError" class="hidden text-center text-red-400 font-semibold text-lg py-8">
                    No products found for your search.
                </p>
                <div id="productContainer" class="flex overflow-x-scroll snap-x-mandatory pb-4 space-x-6 scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-900">
                    <!-- Product cards will be loaded dynamically from admin panel data -->
                </div>
            </div>
        </section>

        <!-- Product Categories Section -->
        <section>
            <h2 class="text-3xl font-bold mb-6 text-white">Product Categories</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Category Card 1: Games -->
                <a href="category-games.html" class="bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center hover:bg-slate-700 transition-colors duration-300 cursor-pointer">
                    <svg class="w-16 h-16 text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="text-xl font-bold text-white mb-2">Games</h3>
                    <p class="text-sm text-gray-400">Gaming accounts, in-game items, and gaming services.</p>
                </a>

                <!-- Category Card 2: Software & Apps -->
                <a href="category-software-apps.html" class="bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center hover:bg-slate-700 transition-colors duration-300 cursor-pointer">
                    <svg class="w-16 h-16 text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                    </svg>
                    <h3 class="text-xl font-bold text-white mb-2">Software & Apps</h3>
                    <p class="text-sm text-gray-400">Software licenses, app subscriptions, and digital tools.</p>
                </a>
                
                <!-- Category Card 3: Boosting & Coaching -->
                <a href="category-boosting-coaching.html" class="bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center hover:bg-slate-700 transition-colors duration-300 cursor-pointer">
                    <svg class="w-16 h-16 text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v14H9z" />
                    </svg>
                    <h3 class="text-xl font-bold text-white mb-2">Boosting & Coaching</h3>
                    <p class="text-sm text-gray-400">Improve your skills with professional player coaching.</p>
                </a>

                <!-- Category Card 4: Gift Cards -->
                <a href="category-gift-cards.html" class="bg-slate-800 rounded-xl shadow-lg border border-slate-700 p-6 flex flex-col items-center text-center hover:bg-slate-700 transition-colors duration-300 cursor-pointer">
                    <svg class="w-16 h-16 text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="text-xl font-bold text-white mb-2">Gift Cards</h3>
                    <p class="text-sm text-gray-400">Digital gift cards for various gaming platforms.</p>
                </a>
            </div>
        </section>

    </main>

    <!-- Footer Section -->
    <footer class="bg-slate-900 text-gray-400 mt-auto py-8 border-t border-slate-700">
        <div class="container mx-auto px-4 flex flex-col lg:flex-row justify-between items-center space-y-6 lg:space-y-0">
            <!-- Left Side: Description and Links -->
            <div class="text-center lg:text-left max-w-xl">
                <p class="text-sm mb-4">
                    S Shop LK is a comprehensive online marketplace for everything gaming-related. We are dedicated to providing a safe and secure community for both buyers and sellers.
                </p>
                <div class="text-xs text-gray-500">
                    &copy; 2025 S Shop LK. All rights reserved. |
                    <a href="about-us.html" class="hover:text-white transition-colors duration-200">About Us</a> |
                    <a href="#" class="hover:text-white transition-colors duration-200">Terms of Service</a> |
                    <a href="#" class="hover:text-white transition-colors duration-200">Privacy Policy</a> |
                    <a href="#" class="hover:text-white transition-colors duration-200">Help Center</a>
                </div>
            </div>

            <!-- Right Side: Social Media Icons (Updated with Image URLs) -->
            <div class="flex space-x-4">
                <!-- WhatsApp Icon -->
                <a href="https://wa.me/94767854069" class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-400 text-gray-400 hover:bg-gray-400 hover:text-slate-900 transition-colors duration-300">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/512px-WhatsApp.svg.png" alt="WhatsApp Icon" class="h-6 w-6">
                </a>
                <!-- Discord Icon -->
                <!-- The footer Discord link is a placeholder for a server invite. You can replace 'YourInviteCode' with your actual Discord server invite. -->
                <a href="https://discord.gg/YourInviteCode" class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-400 text-gray-400 hover:bg-gray-400 hover:text-slate-900 transition-colors duration-300">
                    <img src="https://cdn-icons-png.flaticon.com/512/4945/4945973.png" alt="Discord Icon" class="h-6 w-6">
                </a>
            </div>
        </div>
    </footer>

    <!-- Buy Now Modal (Pop-up Panel) -->
    <div id="buyNowModal" class="fixed inset-0 bg-gray-950 bg-opacity-75 flex items-center justify-center z-[1000] p-4 hidden">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6 md:p-8 w-full max-w-sm text-center border-2 border-blue-600 relative">
            <!-- Close Button -->
            <button class="absolute top-4 right-4 text-gray-400 hover:text-white" onclick="closeModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <h3 class="text-2xl font-bold mb-2 text-white" id="modalTitle">How would you like to buy?</h3>
            <p class="text-gray-400 mb-6" id="modalDescription">Contact a seller to complete your purchase of "<span id="productNameInModal" class="font-semibold text-white">Product Name</span>".</p>
            
            <div class="flex flex-col space-y-4">
                <!-- WhatsApp Button -->
                <a href="#" id="whatsappLink" class="flex items-center justify-center space-x-2 bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors duration-300">
                    <img src="https://image.similarpng.com/file/similarpng/original-picture/2021/01/Whatsapp-icon-with-black-color-on-transparent-background-PNG.png" alt="WhatsApp Icon" class="h-6 w-6">
                    <span>Buy on WhatsApp</span>
                </a>

                <!-- Discord Button -->
                <a href="#" id="discordLink" class="flex items-center justify-center space-x-2 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300">
                    <img src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/discord-round-black-icon.png" alt="Discord Icon" class="h-6 w-6">
                    <span>Buy on Discord</span>
                </a>
            </div>
        </div>
    </div>
    <!-- End of Buy Now Modal -->

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <!-- JavaScript for custom modal and search -->
    <script>
        let products = [];
        let currentCategory = 'all';

        // Load products on page load
        window.addEventListener('load', function() {
            loadProducts();
            loadHeroImages();
            setupAdminAccess();
            setupAuthState();
            setupMobileHeaderScroll();
        });

        // Mobile header scroll behavior
        function setupMobileHeaderScroll() {
            let lastScrollTop = 0;
            const header = document.querySelector('header');
            const mobileBreakpoint = 768;
            
            window.addEventListener('scroll', function() {
                // Only apply on mobile devices
                if (window.innerWidth <= mobileBreakpoint) {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    
                    // Show header when scrolling up or at the top
                    if (scrollTop <= 0) {
                        header.classList.remove('header-hidden');
                    } else if (scrollTop < lastScrollTop) {
                        // Scrolling up - show header
                        header.classList.remove('header-hidden');
                    } else if (scrollTop > lastScrollTop && scrollTop > 100) {
                        // Scrolling down and not at the top - hide header
                        header.classList.add('header-hidden');
                    }
                    
                    lastScrollTop = scrollTop;
                } else {
                    // On desktop, always show header
                    header.classList.remove('header-hidden');
                }
            });
        }

        // Authentication State Management
        function setupAuthState() {
            if (window.AuthService) {
                AuthService.onAuthStateChanged(function(user) {
                    updateAuthUI(user);
                });
            }
        }

        function updateAuthUI(user) {
            const guestUser = document.getElementById('guestUser');
            const loggedInUser = document.getElementById('loggedInUser');
            const avatarInitials = document.getElementById('avatarInitials');
            const dropdownUsername = document.getElementById('dropdownUsername');
            const dropdownEmail = document.getElementById('dropdownEmail');
            
            if (user) {
                // User is signed in
                guestUser.classList.add('hidden');
                loggedInUser.classList.remove('hidden');
                
                // Try to get username from Firestore
                if (window.FirebaseService) {
                    FirebaseService.getUser(user.uid)
                        .then(userData => {
                            if (userData && userData.username) {
                                const username = userData.username;
                                const initials = getInitials(username);
                                avatarInitials.textContent = initials;
                                dropdownUsername.textContent = username;
                                dropdownEmail.textContent = userData.email || user.email || 'user@example.com';
                            } else {
                                const email = user.email || 'User';
                                const initials = getInitials(email);
                                avatarInitials.textContent = initials;
                                dropdownUsername.textContent = email;
                                dropdownEmail.textContent = email;
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching user data:', error);
                            const email = user.email || 'User';
                            const initials = getInitials(email);
                            avatarInitials.textContent = initials;
                            dropdownUsername.textContent = email;
                            dropdownEmail.textContent = email;
                        });
                } else {
                    const email = user.email || 'User';
                    const initials = getInitials(email);
                    avatarInitials.textContent = initials;
                    dropdownUsername.textContent = email;
                    dropdownEmail.textContent = email;
                }
                
                console.log('User is signed in:', user.email);
            } else {
                // User is signed out
                guestUser.classList.remove('hidden');
                loggedInUser.classList.add('hidden');
                console.log('User is signed out');
            }
        }

        // Get initials from name
        function getInitials(name) {
            if (!name) return 'U';
            return name.split(' ').map(word => word.charAt(0).toUpperCase()).join('').slice(0, 2);
        }

        async function signOut() {
            try {
                if (window.AuthService) {
                    await AuthService.signOut();
                    console.log('User signed out successfully');
                    // The UI will update automatically through the auth state listener
                }
            } catch (error) {
                console.error('Error signing out:', error);
                alert('Error signing out. Please try again.');
            }
        }

        // Hero Image Carousel Variables
        let heroImages = [];
        let currentImageIndex = 0;
        let carouselInterval;
        let isAutoPlaying = true;

        function loadHeroImages() {
            // Try to load from Firebase first
            if (window.FirebaseService) {
                FirebaseService.getWebsiteSettings()
                    .then(settings => {
                        if (settings.heroImages && settings.heroImages.length > 0) {
                            heroImages = settings.heroImages;
                            console.log('Loaded hero images from Firebase:', heroImages);
                        } else {
                            loadHeroImagesFromLocalStorage();
                        }
                        
                        // Load background image
                        if (settings.heroBackgroundImage) {
                            loadHeroBackgroundImage(settings.heroBackgroundImage);
                        } else {
                            loadHeroBackgroundImageFromLocalStorage();
                        }
                        
                        // Handle hero image visibility
                        if (settings.showHeroImages !== undefined) {
                            toggleHeroImageVisibility(settings.showHeroImages);
                        } else {
                            toggleHeroImageVisibilityFromLocalStorage();
                        }
                        
                        initializeCarousel();
                    })
                    .catch(error => {
                        console.error('Error loading hero images from Firebase:', error);
                        loadHeroImagesFromLocalStorage();
                        loadHeroBackgroundImageFromLocalStorage();
                        toggleHeroImageVisibilityFromLocalStorage();
                        initializeCarousel();
                    });
            } else {
                loadHeroImagesFromLocalStorage();
                loadHeroBackgroundImageFromLocalStorage();
                toggleHeroImageVisibilityFromLocalStorage();
                initializeCarousel();
            }
        }

        function loadHeroBackgroundImage(backgroundImageUrl) {
            const backgroundElement = document.getElementById('heroBackgroundImage');
            if (backgroundImageUrl) {
                if (typeof backgroundImageUrl === 'string') {
                    // Legacy format - just URL string
                    backgroundElement.style.backgroundImage = `url('${backgroundImageUrl}')`;
                    backgroundElement.style.opacity = '0.2'; // Default 20% opacity
                    backgroundElement.classList.remove('hidden');
                    console.log('Loaded hero background image from Firebase (legacy format):', backgroundImageUrl);
                } else {
                    // New format - object with URL and opacity
                    backgroundElement.style.backgroundImage = `url('${backgroundImageUrl.url}')`;
                    backgroundElement.style.opacity = (backgroundImageUrl.opacity / 100).toString();
                    backgroundElement.classList.remove('hidden');
                    console.log('Loaded hero background image from Firebase:', backgroundImageUrl);
                }
            } else {
                backgroundElement.classList.add('hidden');
            }
        }

        function loadHeroBackgroundImageFromLocalStorage() {
            const backgroundImageData = localStorage.getItem('sShopHeroBackgroundImage');
            if (backgroundImageData) {
                try {
                    const settings = JSON.parse(backgroundImageData);
                    if (typeof settings === 'string') {
                        // Legacy format - just URL string
                        loadHeroBackgroundImage(settings);
                        console.log('Loaded hero background image from localStorage (legacy format):', settings);
                    } else {
                        // New format - object with URL and opacity
                        loadHeroBackgroundImage(settings);
                        console.log('Loaded hero background image from localStorage:', settings);
                    }
                } catch (error) {
                    // Fallback to legacy format
                    loadHeroBackgroundImage(backgroundImageData);
                    console.log('Loaded hero background image from localStorage (fallback):', backgroundImageData);
                }
            }
        }

        function toggleHeroImageVisibility(show) {
            const heroImageContainer = document.getElementById('heroImageContainer');
            if (show && heroImages.length > 0) {
                heroImageContainer.classList.remove('hidden');
                console.log('Hero images are visible');
                // Reinitialize carousel after making it visible
                setTimeout(() => {
                    initializeCarousel();
                }, 100);
            } else {
                heroImageContainer.classList.add('hidden');
                console.log('Hero images are hidden');
                // Stop auto-play when hidden
                if (carouselInterval) {
                    clearInterval(carouselInterval);
                }
            }
        }

        function toggleHeroImageVisibilityFromLocalStorage() {
            const showHeroImages = localStorage.getItem('sShopShowHeroImages');
            if (showHeroImages !== null) {
                toggleHeroImageVisibility(showHeroImages === 'true');
            } else {
                // Default to showing if images exist
                toggleHeroImageVisibility(heroImages.length > 0);
            }
        }

        function loadHeroImagesFromLocalStorage() {
            const storedImages = localStorage.getItem('sShopHeroImages');
            if (storedImages) {
                heroImages = JSON.parse(storedImages);
                console.log('Loaded hero images from localStorage:', heroImages);
            } else {
                // Default images if none are set
                heroImages = [
                    {
                        url: 'https://placehold.co/600x400/805ad5/ffffff?text=S+Shop+LK',
                        alt: 'S Shop LK Hero 1',
                        title: 'Welcome to S Shop LK'
                    },
                    {
                        url: 'https://placehold.co/600x400/667eea/ffffff?text=Gaming+Products',
                        alt: 'S Shop LK Hero 2',
                        title: 'Gaming Products'
                    },
                    {
                        url: 'https://placehold.co/600x400/764ba2/ffffff?text=Best+Deals',
                        alt: 'S Shop LK Hero 3',
                        title: 'Best Deals'
                    }
                ];
                console.log('Using default hero images:', heroImages);
            }
        }

        function initializeCarousel() {
            if (heroImages.length === 0) return;

            const heroContainer = document.getElementById('heroImageContainer');
            const container = document.getElementById('heroImageInnerContainer');
            const indicators = document.getElementById('carouselIndicators');
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');

            // Check if elements exist and hero container is visible
            if (!container || !indicators || !prevButton || !nextButton) {
                console.error('Carousel elements not found');
                return;
            }

            // Only initialize if hero container is visible
            if (heroContainer.classList.contains('hidden')) {
                console.log('Hero container is hidden, skipping carousel initialization');
                return;
            }

            // Clear existing content
            container.innerHTML = '';
            indicators.innerHTML = '';

            // Create image elements
            heroImages.forEach((image, index) => {
                const imgElement = document.createElement('img');
                imgElement.src = image.url;
                imgElement.alt = image.alt;
                imgElement.className = `absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ${index === 0 ? 'opacity-100' : 'opacity-0'}`;
                imgElement.onerror = function() {
                    this.src = 'https://placehold.co/600x400/805ad5/ffffff?text=Image+Error';
                };
                container.appendChild(imgElement);

                // Create indicator
                const indicator = document.createElement('button');
                indicator.className = `w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-white' : 'bg-white bg-opacity-50'}`;
                indicator.onclick = () => goToImage(index);
                indicators.appendChild(indicator);
            });

            // Setup navigation buttons
            prevButton.onclick = () => previousImage();
            nextButton.onclick = () => nextImage();

            // Setup hover effects for navigation buttons
            const carousel = document.getElementById('heroCarousel');
            if (carousel) {
                carousel.addEventListener('mouseenter', () => {
                    prevButton.classList.remove('opacity-0');
                    nextButton.classList.remove('opacity-0');
                    pauseAutoPlay();
                });
                carousel.addEventListener('mouseleave', () => {
                    prevButton.classList.add('opacity-0');
                    nextButton.classList.add('opacity-0');
                    resumeAutoPlay();
                });
            }

            // Start auto-play
            startAutoPlay();
        }

        function showImage(index) {
            const images = document.querySelectorAll('#heroImageInnerContainer img');
            const indicators = document.querySelectorAll('#carouselIndicators button');

            // Hide all images
            images.forEach(img => img.classList.add('opacity-0'));
            indicators.forEach(indicator => indicator.classList.remove('bg-white', 'bg-opacity-50'));

            // Show current image
            if (images[index]) {
                images[index].classList.remove('opacity-0');
                indicators[index].classList.add('bg-white');
            }

            currentImageIndex = index;
        }

        function nextImage() {
            const nextIndex = (currentImageIndex + 1) % heroImages.length;
            showImage(nextIndex);
        }

        function previousImage() {
            const prevIndex = (currentImageIndex - 1 + heroImages.length) % heroImages.length;
            showImage(prevIndex);
        }

        function goToImage(index) {
            showImage(index);
        }

        function startAutoPlay() {
            if (carouselInterval) clearInterval(carouselInterval);
            carouselInterval = setInterval(() => {
                if (isAutoPlaying) {
                    nextImage();
                }
            }, 4000); // Change image every 4 seconds
        }

        function pauseAutoPlay() {
            isAutoPlaying = false;
        }

        function resumeAutoPlay() {
            isAutoPlaying = true;
        }

        function displayProducts() {
            const productContainer = document.getElementById('productContainer');
            productContainer.innerHTML = '';

            // Filter products based on current category
            let filteredProducts = products;
            if (currentCategory !== 'all') {
                filteredProducts = products.filter(product => {
                    const category = product.category?.toLowerCase() || '';
                    if (currentCategory === 'games') {
                        return category.includes('games') || category.includes('gaming') || category.includes('game');
                    } else if (currentCategory === 'software-apps') {
                        return category.includes('software') || category.includes('app') || category.includes('tool') || category.includes('license');
                    }
                    return true;
                });
            }

            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-slate-800 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex-shrink-0 w-64 snap-center border border-slate-700';
                
                // Determine detail page based on product ID
                let detailPage = 'dynamic-product-detail.html?id=' + product.id;

                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full h-32 object-cover rounded-t-xl border-b border-slate-700">
                    <div class="p-4">
                        <h3 class="product-title text-lg font-semibold text-white truncate mb-1">${product.name}</h3>
                        <p class="product-description text-sm text-gray-400 mb-2">${product.description}</p>
                        <span class="text-2xl font-extrabold text-blue-400">LKR ${product.price.toLocaleString()}</span>
                        <div class="flex space-x-2 mt-4">
                            <a href="${detailPage}" class="flex-1 bg-gray-600 text-white py-2 rounded-lg font-semibold hover:bg-gray-700 transition-colors duration-300 text-center">View Details</a>
                            <button class="flex-1 bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-300" onclick="showBuyNowModal('${product.name}')">Buy Now</button>
                        </div>
                    </div>
                `;
                productContainer.appendChild(productCard);
            });
        }

        // Category filtering function
        function filterProducts(category) {
            currentCategory = category;
            
            // Update filter button styles
            const filterButtons = document.querySelectorAll('.category-filter');
            filterButtons.forEach(button => {
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-slate-700', 'hover:bg-slate-600');
            });
            
            // Highlight active filter
            const activeButton = document.getElementById(`filter-${category}`);
            if (activeButton) {
                activeButton.classList.remove('bg-slate-700', 'hover:bg-slate-600');
                activeButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }
            
            // Update products display
            displayProducts();
            
            // Update search functionality to work with filtered products
            updateSearchFunctionality();
        }

        // Update search to work with filtered products
        function updateSearchFunctionality() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
                const searchError = document.getElementById('searchError');
                if (searchError) {
                    searchError.classList.add('hidden');
                }
            }
        }

        // Setup multiple admin panel access methods
        function setupAdminAccess() {
            // Keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                // Ctrl + Alt + A (Windows/Linux) or Cmd + Alt + A (Mac)
                if ((event.ctrlKey || event.metaKey) && event.altKey && event.key === 'a') {
                    event.preventDefault();
                    window.location.href = 'admin-login.html';
                }
                
                // Ctrl + Alt + S (Windows/Linux) or Cmd + Alt + S (Mac)
                if ((event.ctrlKey || event.metaKey) && event.altKey && event.key === 's') {
                    event.preventDefault();
                    window.location.href = 'admin.html';
                }
                
                // F12 key (Developer Tools alternative)
                if (event.key === 'F12') {
                    event.preventDefault();
                    window.location.href = 'admin-login.html';
                }
            });

            // Double-click on logo to access admin
            document.querySelector('a[href="#"]').addEventListener('dblclick', function(event) {
                event.preventDefault();
                window.location.href = 'admin-login.html';
            });

            // Right-click on logo for admin menu
            document.querySelector('a[href="#"]').addEventListener('contextmenu', function(event) {
                event.preventDefault();
                showAdminMenu(event);
            });

            // Triple-click anywhere on the page
            let clickCount = 0;
            let clickTimer;
            document.addEventListener('click', function() {
                clickCount++;
                clearTimeout(clickTimer);
                clickTimer = setTimeout(function() {
                    if (clickCount === 3) {
                        window.location.href = 'admin-login.html';
                    }
                    clickCount = 0;
                }, 500);
            });
        }

        // Show admin menu on right-click
        function showAdminMenu(event) {
            // Remove existing menu
            const existingMenu = document.getElementById('adminMenu');
            if (existingMenu) {
                existingMenu.remove();
            }

            // Create menu
            const menu = document.createElement('div');
            menu.id = 'adminMenu';
            menu.className = 'fixed bg-white border border-gray-300 rounded-lg shadow-lg z-50 py-2';
            menu.style.left = event.pageX + 'px';
            menu.style.top = event.pageY + 'px';

            menu.innerHTML = `
                <div class="px-4 py-2 hover:bg-gray-100 cursor-pointer" onclick="window.location.href='admin-login.html'">
                    üîê Admin Login
                </div>
                <div class="px-4 py-2 hover:bg-gray-100 cursor-pointer" onclick="window.location.href='admin.html'">
                    ‚öôÔ∏è Admin Panel
                </div>
                <div class="border-t border-gray-200 my-1"></div>
                <div class="px-4 py-2 text-sm text-gray-500">
                    Keyboard: Ctrl+Alt+A
                </div>
            `;

            document.body.appendChild(menu);

            // Close menu when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeMenu() {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                });
            }, 100);
        }

        function loadProducts() {
            // Try to load from Firebase first
            if (window.FirebaseService) {
                FirebaseService.getProducts()
                    .then(firebaseProducts => {
                        if (firebaseProducts.length > 0) {
                            products = firebaseProducts;
                            displayProducts();
                            console.log('Loaded products from Firebase:', products);
                        } else {
                            // Fallback to localStorage if no Firebase data
                            loadFromLocalStorage();
                        }
                    })
                    .catch(error => {
                        console.error('Error loading from Firebase:', error);
                        loadFromLocalStorage();
                    });
            } else {
                loadFromLocalStorage();
            }
        }

        function loadFromLocalStorage() {
            const storedProducts = localStorage.getItem('sShopProducts');
            if (storedProducts) {
                products = JSON.parse(storedProducts);
                displayProducts();
            } else {
                // Fallback to products.json if no admin data
                fetch('products.json')
                    .then(response => response.json())
                    .then(data => {
                        products = data.products;
                        displayProducts();
                    })
                    .catch(error => {
                        console.error('Error loading products:', error);
                        // Load default products if both fail
                        products = [];
                        displayProducts();
                    });
            }
        }
        
        /**
         * This function handles the search functionality.
         * It filters the product cards based on the text entered in the search bar.
         */
        function handleSearch() {
            // Get the search input value and convert it to lowercase for case-insensitive matching
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // Get all product cards and the error message element
            const productCards = document.querySelectorAll('.product-card');
            const errorMessage = document.getElementById('searchError');
            let foundProducts = false;

            // Loop through each product card and check if it matches the search term
            productCards.forEach(card => {
                const title = card.querySelector('.product-title').textContent.toLowerCase();
                const description = card.querySelector('.product-description').textContent.toLowerCase();

                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    // If a match is found, show the card
                    card.style.display = 'block';
                    foundProducts = true;
                } else {
                    // If no match is found, hide the card
                    card.style.display = 'none';
                }
            });

            // Display or hide the error message based on whether any products were found
            if (foundProducts) {
                errorMessage.classList.add('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        }
        
        /**
         * This function shows the buy now modal with the specified product name.
         * @param {string} productName The name of the product being purchased.
         */
        function showBuyNowModal(productName) {
            const modal = document.getElementById('buyNowModal');
            const productNameSpan = document.getElementById('productNameInModal');
            const whatsappLink = document.getElementById('whatsappLink');
            const discordLink = document.getElementById('discordLink');

            productNameSpan.textContent = productName;

            // Pre-fill the WhatsApp message with the product name.
            const whatsappNumber = '+94767854069'; 
            const whatsappMessage = encodeURIComponent(`Hello, I would like to buy: ${productName}`);
            whatsappLink.href = `https://wa.me/${whatsappNumber}?text=${whatsappMessage}`;

            // Set the Discord direct message link using the provided user ID.
            const discordUserId = '1078335412713570314'; 
            discordLink.href = `https://discordapp.com/users/${discordUserId}`;

            modal.classList.remove('hidden');
        }

        /**
         * This function closes the buy now modal.
         */
        function closeModal() {
            const modal = document.getElementById('buyNowModal');
            modal.classList.add('hidden');
        }

    </script>

</body>
</html>